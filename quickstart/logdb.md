### 创建日志仓库

日志仓库是用来存放日志数据的容器，依靠仓库名称来区别唯一性。

每一个日志仓库都可以独立设置数据存储的时限、数据结构信息、主键信息。

对于类型为`String`的字段，我们允许对其设置分词方式、是否为主键。

对于类型为`Date`的字段，我们默认支持接收RFC3339格式的日期数据，如果用户的日期类型并非RFC3339，那么也可以单独为这个字段指定日期格式。

!> 注意：只有存储时限为'永久存储'的仓库才可以设置主键，且只能设置一个主键。

**数据源/消息队列节点填写参数说明：**

* 仓库名称：必填项；用来区分其他仓库，唯一标识。
* 所属区域：必填项；所属区域,计算与存储所使用的物理资源所在区域,目前支持华东区域；此参数是为了降低用户传输数据的成本；应当尽量选择离自己数据源较近的区域。
* 数据存储时限：必填项；数据存储的时限，最小为1天，最大为30天，存储时间超过这个时限的数据，将会被系统自动删除，为0时，数据永久存储。


**分词方式详解:**

分词器简单来说定义了两个方面：

	1. 如何将一段文档划分为多个词
	2. 如何对这些词做过滤和处理

	
下面通过阐述一个简单的例子来对分词器如何工作做一个简单的说明。

实例文档：
	
	The 2 QUICK Brown-Foxes jumped over the lazy dog's bone.


简单来说文档在索引的过程中会有以下两个个步骤，了解这个步骤有助于用户理解如何更好的使用LOGDB进行搜索。

	1. 解析此document为多个token，token通常指以非字母数字结束的一个字符串（还有其他的区分方式，比如）,比如'apple+orange'则为两个token 'apple' 'orange'
	2. 进入TokenFilter阶段，即是对每个Token根据所选择的分词器做过滤处理。比如下面几个常见的filter
			
			* lowercase filter，将所有字母变为小写
			* stopword filter， 过滤掉所有定义的stopword，一些常见的比如 'a','the'等
			* 其他特殊的filter。


#### 标准分词(`standard`)
	
	默认的分词选项，划分document时以unicode字符作为结束的标志，然后过滤掉大部分标点符号，将所有字母变为小写。如果您的数据是英文，且不清楚选择哪个分词器，可以选择这个。
	
	unicode字符：详见http://unicode.org/reports/tr29/
		
	standard分词器处理后，实例文档变为:`the, 2, quick, brown, foxes, jumped, over, the, lazy, dog's, bone`几个词

#### 不分词(`keyword`)
	document不划分，整体作为个token。如果字段为ID、国家等类似的时，强烈建议选择此分词器

#### 空白分词(`whitespace`)
	划分document时，碰到空格即认为一个token的结束
	
	whitespace分词器处理后，实例文档变为:  `The, 2, QUICK, Brown-Foxes, jumped, over, the, lazy, dog's, bone.`
	
	keyword分词器处理后，实例文档变为: `The 2 QUICK Brown-Foxes jumped over the lazy dog's bone.`。 注意：此时搜索单个单词无法匹配到该数据，只能输入全部的docuemtn才能成功匹配。

#### 不分词不索引(`no`)
	不分词不索引。该选项生效后，这个字段不能直接通过条件搜索到。
	
#### 中文分词(`index_ansj`)
	 根据中文语义分词，目前基于我们的系统词库来做分词依据。

#### path分词(`path`)
    根据url的path做切分，如"abc/xxx"，会切分为"abc"和"xxx"


**操作演示：**

![](/Users/loris/liurui/pandora-docs-old/_media/logdb1.gif)

### 日志查询

在日志查询页面中，首先我们需要选择一个数据仓库，然后在条件编辑框里编写搜索条件，最后点击数据查询按钮/图表查询按钮即可进行数据查询。

> 提示：
> 
> 1.点击**查询字段**按钮，可以查看这个仓库的字段信息。
> 
> 2.搜索栏上方的时间选择按钮，可以选择查询时间范围。
> 
> 3.在查询时，点击搜索栏右侧的停止按钮可中止本次查询。

**操作演示：**

![](/Users/loris/liurui/pandora-docs-old/_media/logdb2.gif)

### 条件编写规范

|名称|语义|
|:--|:--|
|*|查询所有内容|
|AND|query1 AND query2，查询交集|
|OR	|query1 OR query2，查询并集|
|NOT|query1 AND NOT query2，表示符合query1，不符合query2的结果|
|()	|把一个或多个query合并成一个query，提升优先级|
|[]	|区间查询，包括边界|
|{}|区间查询，不包括边界|
|\|转义字符|
|>,=,<,<=,>=|区间查询|

### 正则表达式查询
正则表达式查询条件编写时，以`"/"`开头和结尾。

比如：`name:/joh?n(ath[oa]n)/`

### 通配符查询
使用`?`代替一个字符，`*`代替0或者多个字符

比如：`qu?ck bro*`

* 注意使用这个查询会消耗大量资源，并且速度会降低。


**查询举例：**

字段名称`name`，类型`string`，包含内容`a`的记录：

?>name:a

字段名称`ip`，类型`string`，包含内容`a`或`b`的记录：

?>ip:a OR ip:b

字段名称`hosts`，类型`string`，包含内容`a`或者`b`,不包含`c`的记录：

?>(hosts:a OR hosts:b) AND (NOT hosts:c)

字段名称`ip`，类型`string`，包含内容`a`或`b`，同时字段名称`hosts`，类型`string`，包含内容`c`的记录：

?>(ip:a OR ip:b) AND (hosts:c)

字段名称`createTime`，类型`date`，包含内容`2016-1-1`到`2016-1-2`的记录：

?>createTime:[2016-01-01 TO 2016-01-02]

字段名称`count`，类型`long`或者`float`，内容大于5的记录： 

?>count:>5


!>日志检索服务在输入查询条件时，在搜索内容中，如果日志记录中包含以下符号，在搜索时，需要以`双引号("")`包含。

```
+  -  
&&  ||  !
( )  { }  [ ] 
^  ”  ~  *  ?  :  \
```


