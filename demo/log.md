### 日志分析 —— 最佳实践

日志分析是大数据应用最为广泛的功能之一，基于七牛Pandora大数据平台提供的`工作流引擎+日志服务`可满足市场上99%的日志分析需求！

#### 典型场景

* 大数据分析
	* 通过 Logkit、API 实时收集事件数据，如PV、UV等。
	* 常规日志归档、统计，以天、周、月等为单位形成分析报告。
	* 通过工作流引擎进行流式计算，实时分析当前业务现状，精准运营、营销。 
* 事故定位
	* 对客户端、移动设备、服务端等设备加入日志并进行关联，实时搜索日志内容，定位信息。
	* 当错误或异常发生时，通过关键字/词等相关信息进行日志检索，快速定位问题，减少影响。
* 日常运维
	* 实时收集不同集群、不同机器、不同应用、不同类别的日志（包括操作日志、错误日志、访问日志等等）。
	* 对不同的日志按照相应类别进行分类管理。
	* 时效日志过期自动删除，重要日志到期自动冷存。 
* 日志审计
	* 通过 Logkit、API 实时收集日志情况，无需担心误操作。
	* 通过日志查询，快速分析日志行为，如某个用户在某个时段的系统操作记录。
	* 支持自动冷存，满足合规审计需求。 
* 其他
	* 计量计费、运营分析、智能分析等等，日志服务应用广泛，几乎任何一个系统都离不开日志分析，七牛内部的每个产品线都在使用。

	
#### 场景1：CDN 日志监控分析

**目的：**

通过收集海量的cdn日志，产出多维度+多特征的日志分析结果：

* CDN宽带/流量
* 回源宽带/流量
* HIT/MISS量统计
* 缓存命中率
* 平均响应时间
* 请求数
* 状态码统计
* 热门分析（流量/请求数）
	* 域名
	* url
	* ip
	* 地区
	* refer
	* UA
* 分省分运营商宽带/流量
* PV/UV
* 全网性能监控
* 运营商占比分析
* CC等防护拦截监控统计
* 分区域分析
	* 宽带/流量
	* 请求数
	* 运营商
	* ip
	* 性能 

**实现过程：**

1.创建日志仓库

首先我们需要在七牛控制台选择`日志检索`服务，然后创建日志仓库；

创建仓库的过程请参考 [快速开始]（日志检索服务-创建日志仓库）

2.创建创建工作流

点击`大数据工作流引擎`服务，然后创建实时/离线工作流；

这个工作流的含义是：建立了一个数据源消息队列——用来接收日志数据，然后将这些数据导出到了我们刚才创建的日志仓库当中；

创建工作流过程请参考 [快速开始]（实时大数据工作流引擎-创建&导出）

3.采集数据

采集数据需要使用Pandora提供的开源工具—— LogKit；
有关LogKit的使用帮助请查看 

`https://github.com/qiniu/logkit/wiki`

4.制作分析报表

数据开始采集后，我们开始配置分析报表；

首先在七牛控制台打开应用市场中的 Grafana 应用；

然后在Grafana中配置相应需要查看的图表；

> Grafana是一个开源的仪表盘和图形编辑器，七牛将其封装形成了一个APP；
> 
> Grafana的使用教程可在APP页面查看；

创建Grafana应用请查看 [应用市场]（Grafana）

**结果：**

![](_media/log4.png)

#### 更多场景

敬请期待...


